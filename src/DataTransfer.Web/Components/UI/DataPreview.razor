@using DataTransfer.Web.Models

@if (Preview != null && Preview.Columns.Any())
{
    <div class="card mt-3">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">Preview</h5>
        </div>
        <div class="card-body">
            @if (Preview.TotalRowCount.HasValue)
            {
                <p class="text-muted mb-2">
                    <small>Showing @Math.Min(Preview.Rows.Count, 10) of @Preview.TotalRowCount.Value rows</small>
                </p>
            }

            @* Column Schema Section *@
            <h6 class="mt-3">Columns</h6>
            <div class="table-responsive" style="max-height: 200px; overflow-y: auto;">
                <table class="table table-sm table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Column Name</th>
                            <th>Data Type</th>
                            <th>Nullable</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var column in Preview.Columns)
                        {
                            <tr>
                                <td><strong>@column.Name</strong></td>
                                <td><code>@column.DataType</code></td>
                                <td>@(column.IsNullable ? "Yes" : "No")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            @* Sample Data Section *@
            @if (Preview.Rows.Any())
            {
                <h6 class="mt-4">Sample Data</h6>
                <div class="table-responsive" style="max-height: 400px; overflow: auto;">
                    <table class="table table-sm table-striped table-hover">
                        <thead class="table-dark sticky-top">
                            <tr>
                                @foreach (var column in Preview.Columns)
                                {
                                    <th>@column.Name</th>
                                }
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var row in Preview.Rows)
                            {
                                <tr>
                                    @foreach (var column in Preview.Columns)
                                    {
                                        <td>
                                            @if (row.ContainsKey(column.Name) && row[column.Name] != null)
                                            {
                                                @row[column.Name]?.ToString()
                                            }
                                            else
                                            {
                                                <span class="text-muted fst-italic">NULL</span>
                                            }
                                        </td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info mt-3">
                    <small>No sample data available (table is empty)</small>
                </div>
            }
        </div>
    </div>
}

@code {
    [Parameter]
    public Models.DataPreview? Preview { get; set; }
}

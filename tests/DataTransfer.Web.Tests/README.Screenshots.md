# Screenshot-Based Test Documentation

This test suite automatically captures screenshots during Playwright E2E tests to create visual documentation of the application's functionality.

## Features

- **Automatic Screenshot Capture**: Every successful test captures screenshots at key points
- **HTML Report Generation**: Creates a beautiful, interactive HTML report showing all screenshots
- **Visual Regression Testing**: Screenshots serve as visual documentation for regression testing
- **Organized by Test**: Screenshots are grouped by test name for easy navigation

## Running Tests with Screenshots

1. Start the web application:
   ```bash
   dotnet run --project src/DataTransfer.Web
   ```

2. Run the tests (screenshots will be captured automatically):
   ```bash
   dotnet test tests/DataTransfer.Web.Tests
   ```

3. View the report:
   ```bash
   open tests/DataTransfer.Web.Tests/test-results/TestReport.html
   # Or on Linux:
   xdg-open tests/DataTransfer.Web.Tests/test-results/TestReport.html
   ```

## Screenshot Locations

- **Raw Screenshots**: `tests/DataTransfer.Web.Tests/test-results/screenshots/*.png`
- **HTML Report**: `tests/DataTransfer.Web.Tests/test-results/TestReport.html`
- **Metadata**: `tests/DataTransfer.Web.Tests/test-results/screenshots/metadata.txt`

## Screenshot Naming Convention

Screenshots follow the pattern: `{TestName}_{StepName}.png`

Examples:
- `HomePage_dashboard_loaded.png`
- `CascadingDropdowns_01_connection_preset.png`
- `NewTransferPage_sql_to_parquet_form.png`

## Test Categories

### WebUITests
- **HomePage**: Dashboard display with statistics cards
- **NewTransferPage**: Form elements for different transfer types
- **HistoryPage**: Transfer history table display
- **Navigation**: Page navigation functionality

### NewTransferDropdownTests (Cascading Dropdowns)
1. Connection Preset Dropdown
2. Database Dropdown (after connection)
3. Schema Dropdown (after database selection)
4. Table Dropdown (after schema selection)
5. Test Connection Button
6. Table Search Input
7. Table Filtering
8. Recent Connections Section

## Customizing Screenshots

To capture screenshots in your own tests:

```csharp
public class MyTests : PlaywrightTestBase
{
    [Fact]
    public async Task My_Test()
    {
        var page = await _browser!.NewPageAsync();

        try
        {
            // ... test logic ...

            // Capture full page screenshot
            await CaptureScreenshotAsync(page, "MyTest", "step_description");

            // Or capture specific element
            var element = page.Locator(".my-element");
            await CaptureElementScreenshotAsync(element, "MyTest", "element_screenshot");
        }
        finally
        {
            await page.CloseAsync();
        }
    }
}
```

## Report Features

The HTML report includes:
- ✅ Grouped screenshots by test category
- ✅ Click-to-zoom modal for full-size viewing
- ✅ Responsive grid layout
- ✅ Timestamp and metadata
- ✅ Hover effects for better UX
- ✅ Clean, professional styling

## Benefits

1. **Visual Documentation**: Stakeholders can see exactly how the UI works
2. **Regression Testing**: Compare screenshots over time to catch UI regressions
3. **Onboarding**: New developers can see the application flow
4. **Bug Reports**: Screenshots help communicate issues clearly
5. **Acceptance Criteria**: Visual proof that features work as intended

## CI/CD Integration

Screenshots can be archived as test artifacts in your CI/CD pipeline:

```yaml
# GitHub Actions example
- name: Run Tests
  run: dotnet test tests/DataTransfer.Web.Tests

- name: Upload Screenshots
  uses: actions/upload-artifact@v3
  with:
    name: test-screenshots
    path: tests/DataTransfer.Web.Tests/test-results/
```

## Troubleshooting

**Q: Screenshots not being generated?**
- Ensure the web server is running before tests
- Check that tests are passing (screenshots only capture on success)
- Verify the `test-results/screenshots` directory exists

**Q: Report not generated?**
- The report is generated by the `GenerateScreenshotReport` test
- Make sure all tests complete successfully
- Check console output for report generation logs

**Q: Screenshots are blank/broken?**
- Ensure Playwright browsers are installed: `pwsh bin/Debug/net8.0/playwright.ps1 install`
- Check that the application is fully loaded before screenshot capture
- Verify network connectivity between test and web server
